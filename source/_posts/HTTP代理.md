---
title: HTTP代理
date: 2018-09-13 23:28:23
tags:
---
> Web 代理（proxy）服务器是网络的中间实体。代理位于客户端和服务器之间，扮演“中间人”的角色，在各端点之间来回传送 HTTP 报文。

> 代理可以改善安全性，提高性能，节省费用。代理服务器可以看到并接触到所有流过的 HTTP 流量，所以代理可以监视流量并对其进行修改，以实现很多有用的增值 Web 服务（儿童过滤器、文档访问控制、安全防火墙、Web 
缓存、反向代理、内容路由器、转码器、匿名者）

*代理与网关的对比:*

*代理连接的是两个或多个使用相同协议的应用程序*

*网关连接的则是两个或多个使用不同协议的端点。网关扮演的是“协议转换器”的角色，即使客户端和服务器使用的是不同的协议，客户端也可以通过它完成与服务器之间的事务处理*

### 私有和共享代理

1. 单个客户端专用的代理被称为私有代理
2. 众多客户端共享的代理被称为公共代理


### 客户端设置代理方式

1. 手工配置

2. 预先配置浏览器

3. 代理的自动配置(PAC)  

    FindProxyForURL(url,host) 的函数-

4. WPAD(Web 代理自动发现协议)

    WPAD 协议规范按顺序定义了下列技术:
    - 动态主机配置协议（Dynamic Host Configuration Protocol，DHCP）
    - 服务定位协议（Service Location Protocol，SLP）
    - DNS 知名主机名
    - DNS SRV 记录
    - TXT 记录中的 DNS 服务 URI

### 代理请求有关的问题
1. 代理URI与服务器URI的不同
    - 客户端向 Web 服务器发送请求时，请求行中只包含部分 URI（没有方案、主机或端口）
    - 客户端向代理发送请求时，请求行中则包含完整的 URI。

    **原因：**
    
    *在原始的 HTTP 设计中，客户端会直接与单个服务器进行对话。不存在虚拟主机，也没有为代理制定什么规则。单个的服务器都知道自己的主机名和端口，所以，为了避免发送冗余信息，客户端只需发送部分URI即可，无需发送方案和主机（以及端口）。*
    
    *代理出现之后，使用部分URI就有问题了。代理需要知道目标服务器的名称，这样它们才能建立自己与服务器的连接。基于代理的网关要知道 URI 的方案才能连接到FTP资源和其他方案上去。HTTP/1.0要求代理请求发送完整的 URI，解决了这个问题，但它为服务器请求保留部分 URI 的形式*

2. `Via`首部
    
    `Via`首部字段列出了与报文途经的每个中间节点（代理或网关）有关的信息。报文每经过一个节点，都必须将这个中间节点添加到 Via 列表的末尾。

    `Via`首部字段用于记录报文的转发，诊断报文循环，标识请求`/`响应链上所有发送者的协议能力

3. `Allow`首部

    `Allow`首部字段列出了请求URI标识的资源所支持的方法列表，如果请求 为`*`的话，列出的就是整个服务器所支持的方法列表。